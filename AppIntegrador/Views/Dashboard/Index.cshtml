@model AppIntegrador.Models.Dashboard

@{
    ViewBag.Title = "Index";
}

    <head>
        <meta charset="UTF-8" , name="viewport" content="width=device-width, initial-scale=1">
        <link href="~/Content/Visualizacion/styles.css" rel="stylesheet" />

        <link href="~/Content/Visualizacion/bootstrap.min.css" rel="stylesheet" />
        <script type="text/javascript" src="~/Scripts/jquery-3.3.1.min.js"></script>
        <script type="text/javascript" src="~/Scripts/bootstrap.min.js"></script>

        <script src="~/Scripts/Visualizacion/filtros.js"></script>
        <link rel="stylesheet" href="~/Content/Visualizacion/bootstrap-multiselect.css" type="text/css" />

        <script type="text/javascript" src="~/Scripts/Visualizacion/bootstrap-multiselect.js"></script>
    </head>

    <body>
        <h3>Dashboard</h3>
        <div class="container-fluid">
            <div class="row">
                <div class="col-3" id="panelFiltros">
                    <h4>Filtros</h4>
                    <script>
                        var filtros = new Filtros();
                        filtros.crearFiltros();
                    </script>

                    <script>
                        //Función que retorna el código de Unidad Académica seleccionada
                        function recuperarUnidadAcademicaSeleccionada()
                        {
                            var ua = document.getElementById("filtroUA");
                            var uaSeleccionada = ua.options[ua.selectedIndex].value;
                            return uaSeleccionada;
                        }
                        //Función que retorna el código de carrera y el código énfasis
                        function recuperarCarreraEnfasis()
                        {
                            var ce = document.getElementById("filtroCarreraEnfasis");
                            var ceSeleccionada = ce.options[ce.selectedIndex].value;
                            if (ceSeleccionada == null)
                                return null;
                            else
                                return ceSeleccionada.split("/");
                        }
                        //Función que retorna la Sigla del curso, Número de Grupo, Semestre, Año
                        function recuperarCursoGrupo()
                        {
                            var cg = document.getElementById("filtroCursoGrupo");
                            var cgSeleccionada = cg.options[cg.selectedIndex].value;
                            if (cgSeleccionada != null)
                                return cgSeleccionada.split("/");
                            else
                                return null;
                        }
                        //Función que retorna el correo del profesor
                        function recuperarProfesor()
                        {
                            var p = document.getElementById("filtroProfesores");
                            var pSeleccionada = p.options[p.selectedIndex].value;
                            return pSeleccionada;
                        }
                        //Método que permite recuperar todas las opciones seleccionadas
                        function recuperarFiltros()
                        {
                            var ua = this.recuperarUnidadAcademicaSeleccionada();
                            var ce = this.recuperarCarreraEnfasis();
                            
                            var codEnfasis = null;
                            var codCarrera = null;
                            if (ce != null)
                            {
                                codCarrera = ce[0];
                                codEnfasis = ce[1];
                            }

                            var sigla = null;
                            var numGrupo = null;
                            var semestre = null;
                            var anno = null;

                            var cg = this.recuperarCursoGrupo();
                            if (cg != null)
                            {
                                sigla = cg[0];
                                numGrupo = cg[1];
                                semestre = cg[2];
                                anno = cg[3];
                            }
                            
                            var correoProf = this.recuperarProfesor();
                        }
                    </script>
                </div>

                <div class="col" id="panelDashboard">

                </div>
            </div>
        </div>
</body>
<!--Como la página web se carga tan rápido, se agregó está sección para asegurarse de que se carga JQuery antes de usar Ajax en el script.-->
@section Scripts {

    @Scripts.Render("~/Scripts/jquery-3.3.1.js");

    <script>

        //Todo parámetro de algún filtro que un usuario no seleccione, debe ser enviado como null.
        var codigoUA = null;
        var codigoCarrera = null;
        var codigoEnfasis = null;
        var siglaCurso = null;
        var numeroGrupo = null;
        var semestre = null;
        var anno = null;
        var correoProfesor = null;

        //Llamado al controlador que recupera los formularios.
        $.ajax({
            url: '/Dashboard/ObtenerFormularios',
            data: {
                codigoUA: codigoUA,
                codigoCarrera: codigoCarrera,
                codigoEnfasis: codigoEnfasis,
                siglaCurso: siglaCurso,
                numeroGrupo: numeroGrupo,
                semestre: semestre,
                anno: anno,
                correoProfesor: correoProfesor
            },
            type: 'post',
            dataType: 'json',
            async: false,
            success: function (resultados) {
                //Se imprime la información de cada formulario para verificar el llamado.
                //alert("Length: " + resultados.length);
                //for (var i = 0; i < resultados.length; ++i) {
                //    alert("Código: " + resultados[i].FCodigo + "\nNombre: " + resultados[i].FNombre + "\nCurso: " + resultados[i].CSigla + "\nGrupo: " + resultados[i].GNumero + "\nSemestre: " + resultados[i].GSemestre + "\nAño: " + resultados[i].GAnno + "\nFecha Inicio: " + resultados[i].FechaInicio + "\nFecha Fin: " + resultados[i].FechaFin);
                //}
            }
        });

    </script>

}

