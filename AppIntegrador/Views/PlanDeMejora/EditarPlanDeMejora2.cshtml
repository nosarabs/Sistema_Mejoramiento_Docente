@model AppIntegrador.Models.PlanDeMejora
@*
    Creado por: Johan Córdoba
    Historia a la que pertenece: MOS-25 "como usuario quiero tener una interfaz que muestre de forma clara las jerarquías entre las distintas partes del subsistema de creación de planes de mejora"
    Vista que contiene todo el plan de mejora después de creado y permite añadir objetivos, acciones y accionables
*@

<div class="fullWidth">
    <div id="modal-containerPlanes" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-content">
        </div>
    </div>

    <div class="planDiv">

        <h2>Crear Plan de mejora @ViewBag.IdPlan </h2>

        <form role="form" id="newPlan" action="EditarPlanDeMejora2" method="post">
            @Html.AntiForgeryToken()
            @Html.HiddenFor(model => model.codigo)

            <div class="form-group">
                <div class="row">
                    <div class="col-md-8">
                        @Html.LabelFor(model => model.nombre, htmlAttributes: new { @class = "control-label" })
                        <div class="row">
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.nombre, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.nombre, "", new { @class = "text-danger" })
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(model => model.fechaInicio, htmlAttributes: new { @class = "control-label" })
                        <div class="row">
                            <div class="col-md-12">
                                @Html.EditorFor(model => model.fechaInicio, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.fechaInicio, "", new { @class = "text-danger" })
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(model => model.fechaFin, htmlAttributes: new { @class = "control-label" })
                        <div class="row">
                            <div class="col-md-12">
                                @Html.EditorFor(model => model.fechaFin, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.fechaFin, "", new { @class = "text-danger" })
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="row">
                    <div class="botonCentrado">
                        <input type="submit" value="Guardar" class="btn btn-success" />
                    </div>
                </div>
            </div>
        </form>

        <div class="planDiv2">
            <div id="crearNuevoObjetivo">
                <h2>Objetivos del Plan de mejora @ViewBag.IdPlan </h2>
                <div id="crear">
                    @Html.Action("divObjetivo", new { id = ViewBag.IdPlan })
                </div>
            </div>
            <div>
                <h4 style="text-align:center">Lista de objetivos</h4>

                <div id="divObjetivos">
                    @Html.Partial("_objetivosDelPlan", Model.Objetivo)
                </div>
            </div>

            <div class="planDiv3">
                <div id="crearNuevaAccion">
                    <h2>Seleccione un Objetivo</h2>
                    <div id="crearAccion">
                        @*@Html.Action("divObjetivo", new { id = ViewBag.IdPlan })*@
                    </div>
                </div>
                <div>
                    <h4 style="text-align:center">Lista de acciones de mejora</h4>

                    <div id="divAccion">
                        @*@Html.Partial("_objetivosDelPlan", Model.Objetivo)*@
                    </div>
                </div>

            </div>

        </div>
    </div>
</div>

<div>
    @Html.ActionLink("Back to List", "Index")
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/jquery")

    <script type="text/javascript">
        $(function () {
            // Initialize numeric spinner input boxes
            //$(".numeric-spinner").spinedit();

            // Initalize modal dialog
            // attach modal-container bootstrap attributes to links with .modal-link class.
            // when a link is clicked with these attributes, bootstrap will display the href content in a modal dialog.
            $('body').on('click', '.modal-link', function (e) {
                e.preventDefault();
                $(this).attr('data-target', '#modal-containerPlanes');
                $(this).attr('data-toggle', 'modal');
            });

            // Attach listener to .modal-close-btn's so that when the button is pressed the modal dialog disappears
            $('body').on('click', '.modal-close-btn', function () {
                $('#modal-containerPlanes').modal('hide');
            });

            //clear modal cache, so that new content can be loaded
            $('#modal-containerPlanes').on('hidden.bs.modal', function () {
                $(this).removeData('bs.modal');
            });

            $('#CancelModal').on('click', function () {
                return false;
            });

            $('body').on('click', '#CANCEL', function (e) {
                alert(e.type);
            });

            //$('body').on('click', '#crearObjetivoButton', function (e) {
            //    aquí también se puede validar
            //});

            //modifica la vista parcial de los objetivos al crear uno nuevo
            $('#newObjetivo').submit(function (e) {
                //alert("dentro del submit");
                var id = "@ViewBag.IdPlan";
                e.preventDefault();
                $.ajax({
                    url:'/PlanDeMejora/CrearObjetivo/',
                    type:'post',
                    data:$('#newObjetivo').serialize(),
                    success:function(){
                        $.ajax({
                            type: 'GET',
                            url: "@Url.Content("/PlanDeMejora/RefrescarObjetivos/")",
                            data : {
                                        Id:id  //Data need to pass as parameter
                                    },
                            dataType: 'html', //dataType - html
                            success:function(result)
                            {
                                //alert ("Inside ajax"),
                                $('#divObjetivos').html(result);
                            }
                        });
                    }
                });
            });

            @*$("#crearObjetivoButton"). click(function (e) {
                aquí se puede validar sobre objetivos
            });*@

            $("#dataOb tr").click(function () {
                alert("here");
                var selected = $(this).hasClass("highlight");
                $("#dataOb tr").removeClass("highlight");
                if (!selected)
                    $(this).addClass("highlight");
            });

        });

        //actualizarObjetivos = function (id) {
            //poner aquí la función de ajax anidada
        //};
    </script>

    <script>
        clickObjetivo = function (id, plan, obj) {
            //alert("plan id:" + plan + " nombre obj:" + obj + " id obj:" + id);
            var content = '<h2>Acciones de mejora del Objetivo ' + id + '</h2>';
            document.getElementById('crearNuevaAccion').innerHTML = content;
        };
    </script>
}
